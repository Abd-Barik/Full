{% load static %}
{% block extra_css %}
  <style>
    .chat-container {
      height: 600px;
      display: flex;
      flex-direction: column;
      border-radius: 1rem;
      box-shadow: 0 0.5rem 1rem rgba(0,0,0,.15);
      overflow: hidden;
    }
    .chat-messages {
      flex: 1;
      overflow-y: auto;
      padding: 1rem;
      background: #fff;
    }
    .chat-message {
      display: flex;
      gap: 0.5rem;
      margin-bottom: 1rem;
    }
    .chat-message.ai .message-bubble {
      background: #6C73A8;
      color: #fff;
      border-radius: 1rem;
      padding: .5rem 1rem;
      max-width: 75%;
    }
    .chat-message.user {
      justify-content: flex-end;
    }
    .chat-message.user .message-bubble {
      background: #e9ecef;
      border-radius: 1rem;
      padding: .5rem 1rem;
      max-width: 75%;
    }
    .chat-input {
      background: #F3F3FE;
      padding: .75rem;
      display: flex;
      gap: .5rem;
      align-items: center;
    }
  </style>
{% endblock extra_css %}

<!-- Theme Settings -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="theme-settings-offcanvas">
  <div class="chat-container bg-white">
    
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center px-3 py-2 text-white" style="background:#6C73A8;">
      <div class="d-flex align-items-center gap-2">
        <img src="https://cdn.jotfor.ms/assets/agent-avatars/avatar_29.png" class="rounded-circle" width="32" height="32" />
        <span class="fw-semibold">Noupe AI</span>
      </div>
      <button type="button" class="btn btn-sm btn-light rounded-circle">âœ•</button>
    </div>

    <!-- Messages -->
    <div id="chat-container" class="chat-messages">
      <div class="chat-message ai">
        <img src="https://cdn.jotfor.ms/assets/agent-avatars/avatar_icon_29.png" class="rounded-circle" width="32" height="32" />
        <div class="message-bubble">Hi there! ðŸ‘‹ I'm Noupe. How can I assist you today?</div>
      </div>
    </div>

    <!-- Input -->
    <div class="chat-input">
      <textarea id="ai-input" class="form-control flex-grow-1" rows="1" placeholder="Type here..."></textarea>
      <button id="sendBtn" class="btn btn-dark">Send</button>
    </div>

    <!-- Footer -->
    <div class="d-flex justify-content-between align-items-center px-3 py-2 bg-light small">
      <span>By chatting, you agree to <a href="#" class="text-decoration-underline">AI Terms of Use</a>.</span>
      <a href="https://noupe.com" target="_blank">
        <img src="https://cdn.jotfor.ms/assets/img/noupe/logo.png" class="img-fluid" style="height:12px;" />
      </a>
    </div>
  </div>
</div>

{% block extra_javascript %}
<script>
  const chatContainer = document.getElementById("chat-container");
  const input = document.getElementById("ai-input");
  const sendBtn = document.getElementById("sendBtn");

  function appendMessage(content, from = "user") {
    const msg = document.createElement("div");
    msg.className = `chat-message ${from}`;
    if (from === "user") {
      msg.innerHTML = `
        <div class="message-bubble">${content}</div>
      `;
    } else {
      msg.innerHTML = `
        <img src="https://cdn.jotfor.ms/assets/agent-avatars/avatar_icon_29.png" class="rounded-circle" width="32" height="32" />
        <div class="message-bubble">${content}</div>
      `;
    }
    chatContainer.appendChild(msg);
    chatContainer.scrollTop = chatContainer.scrollHeight;
  }

  sendBtn.addEventListener("click", () => {
    const text = input.value.trim();
    if (!text) return;
    appendMessage(text, "user");
    input.value = "";

    // Fake AI reply
    setTimeout(() => {
      appendMessage("ðŸ¤– This is a placeholder AI response.", "ai");
    }, 800);
  });
</script>
{% endblock extra_javascript %}
